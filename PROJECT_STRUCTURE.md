# Project Structure

This project follows **Clean Architecture** principles to ensure isolation of business logic from external concerns (HTTP, Database, Frameworks).

## Directory Tree

```text
.
├── cmd/
│   └── api/                # Application entry point
│       └── main.go         # Wire up dependencies and start the server
├── domain/                 # (Core) Business entities and repository interfaces
│   ├── account.go          # Struct definitions + Repository Interface
│   ├── user.go
│   └── ...
├── internal/
│   ├── api/                # Transport Layer (Adapters)
│   │   ├── handler/        # HTTP Handlers (controllers)
│   │   ├── middleware/     # Auth, Logging, CORS
│   │   ├── router/         # Route definitions and Redoc registration
│   │   └── dto/            # Data Transfer Objects (Request/Response structs)
│   ├── service/            # Use Cases (Business Logic)
│   │   ├── account_service.go # Orchestrates entities and repos
│   │   └── user_service.go
│   ├── db/                 # Persistence Layer (Adapters)
│   │   └── postgres/       # SQL implementation using pgx
│   ├── config/             # Configuration loading (env vars, .yaml)
│   └── auth/               # Identity Provider integration (Supabase)
├── docs/                   # Documentation
│   └── swagger.yaml        # Auto-generated OpenAPI 3.0 specification
├── migrations/             # Database migrations
└── Makefile                # Automation commands
```

---

## Architectural Layers

### 1. Domain Layer (`/domain`)
The center of the application. It contains entities and repository interfaces. 
- **Rule**: This layer must **never** import anything from `internal`.

### 2. Service Layer (`/internal/service`)
Contains the business logic (Use Cases). It acts as an orchestrator between the API layer and the Domain.
- **Responsibility**: Orchestrates domain logic and implements business rules.
- **Dependency**: Receives and returns **Domain Entities** (or primitives). It should NOT know about DTOs.
- **Rule**: Pure business logic. No JSON tags, no validator tags, no web concerns.

### 3. API Layer (`/internal/api`)
Handles all HTTP-specific logic using the **Gin** framework. 
- **Handlers**: Act as a "Translator". They parse JSON into **DTOs** using Gin's binding, map those DTOs to **Domain Entities** to call the service, and map returned entities back to **Response DTOs**.
- **DTOs**: Located in `/internal/api/dto`. These contain the JSON tags, validation rules (using Gin's default validator), and OpenAPI annotations.
- **Redoc**: Integrated via `github.com/mvrilo/go-redoc` to render the `docs/swagger.yaml` at the `/docs` endpoint.

---

## Data Flow & Mapping

To maintain strict isolation, mapping happens in the **API layer**:

1. **Request**: `JSON` → `Handler` → `mapping to Entity` → `Service`
2. **Response**: `Service` → `Domain Entity` → `Handler` → `mapping to DTO` → `JSON`

---

## Documentation (OpenAPI)
Documentation is automated using **swag**.
- **Annotations**: Handlers and DTOs are decorated with structured comments.
- **Automation**: The specification is generated by running `make swagger`, which creates `docs/swagger.yaml`.
- **Serving**: The API serves this file via the `/docs` endpoint using **Redoc**.
